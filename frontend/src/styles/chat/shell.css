@layer features.chat {
  /* Chat shell and layout scaffolding */
  :root {
    container-type: inline-size;
  }

  @media (prefers-contrast: high) {
    :root {
      --border: var(--color-black);
      --text: var(--color-black);
      --muted: #222222;
      --shadow: none;
      --shadow-sm: none;
      --shadow-md: none;
      --shadow-lg: none;
    }

    .btn,
    .input,
    .message--user .message__bubble {
      border-width: 2px;
    }
  }

  .app-shell {
    display: flex;
    flex-direction: column;
    min-block-size: 100vh;
    min-block-size: 100svh;
    min-block-size: 100dvh;
    background:
      radial-gradient(135% 120% at 0% 0%, rgba(174, 174, 174, 0.08), transparent 60%),
      radial-gradient(160% 160% at 100% 10%, rgba(140, 140, 140, 0.12), transparent 72%),
      var(--bg);
    color: var(--text);
    container-type: inline-size;
    isolation: isolate;
    position: relative;
    overflow-y: auto;
    overscroll-behavior-y: contain;
    padding-block-end: env(safe-area-inset-bottom, 0px);
  }

  .app-shell::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.32) 0%, rgba(255, 255, 255, 0) 40%);
    pointer-events: none;
    mix-blend-mode: soft-light;
    opacity: 0.75;
  }

  .app-shell > * {
    position: relative;
    z-index: 1;
  }

  .app-body-row {
    flex: 1;
    display: flex;
    align-items: stretch;
    gap: var(--space-xl);
    padding: 0;
    inline-size: 100%;
    max-inline-size: none;
    margin: 0;
    min-block-size: 0;
  }

  @container (max-width: 1024px) {
    .app-body-row {
      flex-direction: column;
      gap: var(--space-lg);
    }
  }

  @container (max-width: 768px) {
    .chat-panel {
      padding-block: var(--space-xl);
      padding-inline: var(--space-lg);
    }
  }

  @container (max-width: 640px) {
    .header {
      padding-block: var(--space-md);
      padding-inline: var(--space-lg);
    }

    .chat-panel {
      padding-block: var(--space-xl);
      padding-inline: var(--space-md);
    }

    .composer {
      padding: var(--space-md);
    }
  }

  .main {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-inline-size: 0;
    min-block-size: 0;
    padding: 0;
  }

  .main--builder {
    overflow: visible;
  }

  .chat-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 0;
    background: transparent;
    border-radius: 0;
    border: none;
    box-shadow: none;
    overflow: hidden;
    min-block-size: 0;
  }

  .chat-panel__body {
    flex: 1;
    min-block-size: 0;
    display: flex;
    flex-direction: column;
    background: transparent;
    border-radius: 0;
    border: none;
    padding: 0;
    box-shadow: none;
    overflow: hidden;
    position: relative;
    /* Reserve space so the fixed VoiceStatusPanel doesn't overlap last messages */
    padding-block-end: calc(env(safe-area-inset-bottom, 0px) + 96px);
  }

  .mt-12 {
    margin-block-start: var(--space-md);
  }
}
